<!DOCTYPE html>
<html>
    <head>
      <title>万卡商城</title>
      <meta name="keywords" content="久富时代,久富金融,久富微金融,久富理财,久富官网,玖富时代,玖富金融,玖富微金融,玖富理财,玖富官网">
      <meta name="description" content="玖富9Fbank.com--中国领先个人微金融服务平台！微理财，微信贷，云银行，专注小微信贷与个人金融服务！">
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="renderer" content="webkit">
      <meta http-equiv="Cache-Control" content="no-siteapp">
      <meta http-equiv="Cache-Control" content="no-transform">
      <meta name="format-detection" content="telephone = no">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-status-bar-style" content="black">
      <meta name="apple-mobile-web-app-title" content="万卡商城">
      <meta name="mobile-web-app-capable" content="yes">
      <meta name="msapplication-TileColor" content="#ff9230">
      <link rel="stylesheet" href="https://sc.9fbank.com/qualitymarkets/static/css/app.400074a10010e74536bf867abec427d7.css">
      <script type="text/javascript">
        !function(a,b){function c(){var b=f.getBoundingClientRect().width;b/i>540&&(b=540*i);var c=b/10;f.style.fontSize=c+"px",k.rem=a.rem=c}var d,e=a.document,f=e.documentElement,g=e.querySelector('meta[name="viewport"]'),h=e.querySelector('meta[name="flexible"]'),i=0,j=0,k=b.flexible||(b.flexible={});if(g){var l=g.getAttribute("content").match(/initial\-scale=([\d\.]+)/);l&&(j=parseFloat(l[1]),i=parseInt(1/j))}else{if(h){var m=h.getAttribute("content");if(m){var n=m.match(/initial\-dpr=([\d\.]+)/),o=m.match(/maximum\-dpr=([\d\.]+)/);n&&(i=parseFloat(n[1]),j=parseFloat((1/i).toFixed(2))),o&&(i=parseFloat(o[1]),j=parseFloat((1/i).toFixed(2)))}}}if(!i&&!j){var p=a.navigator.userAgent,q=(!!p.match(/android/gi),!!p.match(/iphone/gi)),r=q&&!!p.match(/OS 9_3/),s=a.devicePixelRatio;i=q&&!r?s>=3&&(!i||i>=3)?3:s>=2&&(!i||i>=2)?2:1:1,j=1/i}if(f.setAttribute("data-dpr",i),!g){if(g=e.createElement("meta"),g.setAttribute("name","viewport"),g.setAttribute("content","initial-scale="+j+", maximum-scale="+j+", minimum-scale="+j+", user-scalable=no"),f.firstElementChild){f.firstElementChild.appendChild(g)}else{var t=e.createElement("div");t.appendChild(g),e.write(t.innerHTML)}}a.addEventListener("resize",function(){clearTimeout(d),d=setTimeout(c,300)},!1),a.addEventListener("pageshow",function(a){a.persisted&&(clearTimeout(d),d=setTimeout(c,300))},!1),"complete"===e.readyState?e.body.style.fontSize=12*i+"px":e.addEventListener("DOMContentLoaded",function(){e.body.style.fontSize=12*i+"px"},!1),c(),k.dpr=a.dpr=i,k.refreshRem=c,k.rem2px=function(a){var b=parseFloat(a)*this.rem;return"string"==typeof a&&a.match(/rem$/)&&(b+="px"),b},k.px2rem=function(a){var b=parseFloat(a)/this.rem;return"string"==typeof a&&a.match(/px$/)&&(b+="rem"),b}}(window,window.lib||(window.lib={}));
      </script>
		  <script src="https://wx-cdn.9fbank.com/static/public/js/fastclick.min.js"></script>
		  <script type="text/javascript">
		  if ('addEventListener' in document) {document.addEventListener('DOMContentLoaded', function() {FastClick.attach(document.body);}, false);}
      </script>
    </head>
  <body>
      <section class="maxHeight">
        <section>
          <form class="search-form-box flex search-page">
            <a id="searchBackBtn" href="javascript:void(0)" class="return cell_0"></a>
            <div class="search-form-input cell_1">
              <span class="search-form-icon"></span>
              <input type="text" id="jsSearch" placeholder="输入搜索关键字" class="index_newkeyword">
            </div>
            <a id="searchBtn" href="javascript:;" class="btn_sousuo cell_0">搜索</a>
          </form>
          <ul class="new-search-tab flex">
            <li class="new-change-arow cell_1 active">
              <span>综合</span>
            </li>
            <li class="new-change-arow new-sort-down cell_1">
              <span class="Z_mr">按销量</span>
            </li>
            <li class="new-change-arow new-sort-price cell_1 price_down">
              <span class="A_img ">按价格</span>
            </li>
          </ul>
          <div class="layout_content">
              <% if (goodsList.length > 0) { %>
                <ul id="searchlistWrap" class="searchlist-normal">
                    <% for(var i=0; i < goodsList.length; i++){%>
                      <li class="normal-list">
                        <a href="/detail?productNo=<%= goodsList[i].productNo %>&isActivity=0" class="pList_product flex">
                          <span class="product-img cell_0">
                            <img alt="<%= goodsList[i].productName %>" class="lazy" src="<%= goodsList[i].proImage %>" lazy="loaded">
                          </span>
                          <div class="product-info cell_1">
                            <p class="product-name"><%= goodsList[i].productName %></p>
                            <p class="product-price-all">售价：<%= goodsList[i].price %>元</p>
                            <p class="product-price-month">
                              <span><b><%= goodsList[i].monthAmount %></b> 元</span> ×
                            <i><%= goodsList[i].monthnum %></i>期
                          </p>
                          </div>
                        </a>
                      </li>
                    <%}%>
              </ul>
           <%} else {%>
          <div id="noResultWrap" class="no-data">
            <p>抱歉  未找到相关结果</p>
            <p>您可以重新搜索</p>
            <a href="#/" class="go_btn router-link-active">去首页看看</a>
          </div>
          <%}%>
      </div>
    </section>
  </section>
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script>
    window.onload = function () {
      var pageNo = 1,
          isLoadData = false;
    // 拼接模版字符串
    function appendHtml (data) {
      var temp = ''
      data.goodsList.map((val, key) => {
        temp += `<li class="normal-list">
                    <a href="/detail?productNo=${val.productNo}&isActivity=0" class="pList_product flex">
                      <span class="product-img cell_0">
                        <img alt="${val.productName}" class="lazy" src="${val.proImage}" lazy="loaded">
                      </span>
                      <div class="product-info cell_1">
                        <p class="product-name">${val.productName}</p>
                        <p class="product-price-all">售价：${val.price}元</p>
                        <p class="product-price-month">
                          <span><b>${val.monthAmount}</b> 元</span> ×
                        <i>${val.monthnum}</i>期
                      </p>
                      </div>
                    </a>
                  </li>`
      })
      // console.log(temp)
      $('#searchlistWrap').append(temp)
    }
    // 绑定滚动条事件
    window.addEventListener('scroll', function () {
      let isBottom = document.body.scrollTop + document.documentElement.clientHeight + 10 >= document.body.scrollHeight
      if (isBottom && !isLoadData) {
        fetchGoodsList(pageNo)
      }
    }, false)

    // 获取商品列表
  
    function fetchGoodsList (pageNo) {
      if (isLoadData) {
        return false
      }
      isLoadData = true
      ++pageNo
      $.ajax({
        url: 'http://localhost:3000/api/postGoodsList',
        type: 'post',
        dataType: 'json',
        data: {
          pageNo
        },
        headers: {
          "Content-Type": 'application/x-www-form-urlencoded'
        },
        success (res) {
          appendHtml(res)
          console.log(res)
        },
        error (err) {
          console.log(err)
        },
        complete () {
          isLoadData = false
        }
      })
    }

    // 点击搜索
    $('#searchBtn').on('click', function () {
      pageNo = 1
      $.ajax({
        url: "http://localhost:3000/api/search",
        type: 'post',
        dataType: 'json',
        data: {
          pageNo: pageNo,
          productName: $('#jsSearch').val()
        },
        headers: {
          "Content-Type": 'application/x-www-form-urlencoded'
        },
        success (res) {
          console.log(res)
        },
        error (err) {
          console.log(err)
        },
        complete () {
        }
      })
    })
  }
  </script>
</body>
</html>
